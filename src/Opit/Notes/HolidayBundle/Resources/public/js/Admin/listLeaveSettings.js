// Generated by CoffeeScript 1.7.1
(function() {
  var disableSaveButton, leaveSettingWrapper, idIteratorValue, isHadChild;

  leaveSettingWrapper = '';

  idIteratorValue = 0;

  isHadChild = false;

  $('#list-settings').on('click', '.addLeaveSetting', function(event) {
    var clonedLeaveSettingWrapper, groupId;
    event.preventDefault();
    clonedLeaveSettingWrapper = leaveSettingWrapper;
    idIteratorValue++;
    clonedLeaveSettingWrapper = clonedLeaveSettingWrapper.replace(/__index__/g, idIteratorValue);
    $(this).siblings('.container').append(clonedLeaveSettingWrapper);
    groupId = $(this).siblings('.container').find('.holiday_group_id').val();
    return $('#leaveSetting' + idIteratorValue + 'leaveGroup').val(groupId);
  });

  $('#list-settings').on('click', '.deleteLeaveSetting', function() {
    return $(this).parent().parent().remove();
  });

  disableSaveButton = function(disable) {
    if (disable === true) {
      return $('#save').attr('disabled', true);
    } else {
      return $('#save').removeAttr('disabled');
    }
  };

  $('#save').click(function(event) {
    var form, isHasChild;
    event.preventDefault();
    form = $('form');
    isHasChild = $('#list-settings').children('.formFieldsetChild').length > 0;
    if (form.valid() && (isHasChild || isHadChild)) {
      disableSaveButton(true);
      $.ajax({
        method: 'POST',
        data: form.serialize(),
        dataType: 'json',
        url: Routing.generate('OpitNotesHolidayBundle_admin_save_holiday_setting')
      }).done(function(data) {
        var response;
        disableSaveButton(false);
        response = data;
        $.ajax({
          type: 'POST',
          url: Routing.generate('OpitNotesHolidayBundle_admin_list_holiday_settings'),
          data: {
            "showList": 1
          }
        }).done(function(data) {
          $('#list-settings').html(data);
          $(document).data('notes').funcs.showAlert(response, "create", "Holiday settings saved successfully!");
          return isHadChild = $('.container').children('.formFieldsetChild').length > 0;
        }).fail(function(data) {
          return $(document).data('notes').funcs.showAlert(response, "create", "Error", true);
        });
      }).fail(function(data) {
        return $(document).data('notes').funcs.showAlert(response, "create", "Error", true);
      });
      return;
    } else {
      disableSaveButton(false);
    }
  });

  $(document).ready(function() {
    idIteratorValue = $('.formFieldsetChild').length;
    isHadChild = $('.container').children('.formFieldsetChild').length > 0;
    $.ajax({
      method: 'GET',
      url: Routing.generate('OpitNotesHolidayBundle_admin_show_holiday_setting')
    }).done(function(data) {
      leaveSettingWrapper = data;
    });
  });

  $(document).ajaxStop(function() {
    return $(document).data('notes').funcs.makeElementToggleAble('h3', $('.formFieldset'));
  });

}).call(this);
