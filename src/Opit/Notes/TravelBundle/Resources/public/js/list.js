// Generated by CoffeeScript 1.6.3
(function() {
  $("#list-table").on("click", ".clickable", function() {
    var id;
    event.preventDefault();
    id = $(this).attr("data-tr-id");
    $.ajax({
      method: 'POST',
      url: $(document).data('OpitNotesTravelBundle').urls.OpitNotesTravelBundle_travel_show_details,
      data: {
        'id': id
      }
    }).done(function(data) {
      var dialogWidth;
      dialogWidth = 550;
      $('<div id="dialog-show-details-tr"></div>').dialog({
        open: function() {
          $('.ui-dialog-title').append('<i class="fa fa-list-alt"></i> Details');
          return $(this).html(data);
        },
        dialogClass: 'popup-dialog',
        width: dialogWidth,
        position: [($(window).width() - dialogWidth) / 2, $(window).height() / 20],
        modal: true,
        buttons: {
          Close: function() {
            $('#dialog-show-details-tr').dialog("destroy");
          }
        }
      });
    });
  });

  $('#list-table th i').click(function() {
    return $('.deleteMultipleTravelRequest').checkAll();
  });

  $('.deleteSingeTravelRequest').click(function() {
    var $checkbox, empName, self;
    event.preventDefault();
    self = $(this);
    empName = self.closest('tr').children('td.employee-name').text();
    $checkbox = self.closest('tr').find(':checkbox');
    $checkbox.prop('checked', true);
    $('<div></div>').html("Are you sure you want to delete the travel request?").dialog({
      title: 'Travel request removal',
      buttons: {
        Yes: function() {
          $.ajax({
            method: 'POST',
            url: self.attr('href'),
            data: {
              'id': self.data('id')
            }
          }).done(function(data) {
            if (data === '0') {
              self.parent().parent().remove();
            }
          }).fail(function() {
            return $('<div></div>').html("The travel request could not be deleted due to an error.").dialog({
              title: 'Error'
            });
          });
          $(this).dialog("close");
        },
        No: function() {
          $checkbox.prop('checked', false);
          $(this).dialog("close");
        }
      },
      close: function() {
        $(this).dialog("destroy");
      }
    });
  });

  $('#delete').click(function() {
    var selectedTravelRequestRow, travelRequests;
    travelRequests = [];
    selectedTravelRequestRow = [];
    $('.deleteMultipleTravelRequest').each(function() {
      if ($(this).is(':checked')) {
        travelRequests.push($(this).val());
        return selectedTravelRequestRow.push($(this).parent().parent());
      }
    });
    $('<div></div>').html('Are you sure you want to delete the selected travel requests?').dialog({
      title: 'Travel request removal',
      buttons: {
        Yes: function() {
          $.ajax({
            method: 'POST',
            url: $('.deleteSingeTravelRequest').attr('href'),
            data: {
              'id': travelRequests
            }
          }).done(function(data) {
            $(selectedTravelRequestRow).each(function() {
              return $(this).remove();
            });
          }).fail(function() {
            return $('<div></div>').html("The travel request could not be deleted due to an error.").dialog({
              title: 'Error'
            });
          });
          $(this).dialog("close");
        },
        No: function() {
          $(this).dialog("close");
        }
      },
      close: function() {
        $(this).dialog("destroy");
      }
    });
  });

}).call(this);
