// Generated by CoffeeScript 1.6.3
(function() {
  var $subMenuClone, changeDeleteButton, cloneSubmenu, getAllNotifications, getUnreadNotifications, subMenuCloneClass;

  $(document).data('OpitNotesUserBundle', {});

  $.extend(true, $(document).data('OpitNotesUserBundle'), {
    funcs: {
      userEdit: function(userId, successCallback) {
        return $.ajax({
          method: 'GET',
          url: Routing.generate('OpitNotesUserBundle_user_show', {
            id: userId
          })
        }).done(function(data) {
          $('<div id="dialog-edititem"></div>').html(data).dialog({
            open: function() {
              return $('.ui-dialog-title').append('<i class="fa fa-list-alt"></i> Edit User');
            },
            width: 750,
            modal: true,
            buttons: {
              Save: function() {
                return $.ajax({
                  type: 'POST',
                  url: Routing.generate('OpitNotesUserBundle_user_add', {
                    id: userId
                  }),
                  data: $('#adduser_frm').serialize()
                }).done(function(data) {
                  var response, url;
                  url = Routing.generate('OpitNotesUserBundle_user_list');
                  if (url === window.location.pathname) {
                    response = data;
                    $.ajax({
                      type: 'POST',
                      url: url,
                      data: {
                        "showList": 1
                      }
                    }).done(function(data) {
                      var postActions;
                      $('#user-list').html(data);
                      if (successCallback != null) {
                        postActions = successCallback(response, "update", "User modified successfully");
                      }
                      if (postActions || postActions === void 0) {
                        return $('#dialog-edititem').dialog('destroy');
                      }
                    });
                  } else {
                    $('#dialog-edititem').dialog('destroy');
                  }
                }).fail(function(data) {
                  return successCallback($.parseJSON(data.responseText), "update", "Error");
                });
              },
              Close: function() {
                $('#dialog-edititem').dialog("destroy");
              }
            }
          });
          return;
        });
      }
    }
  });

  $subMenuClone = {};

  subMenuCloneClass = '.subMenuClone';

  cloneSubmenu = function() {
    if ($('body').children(subMenuCloneClass).length) {
      $('body').find(subMenuCloneClass).remove();
    }
    $subMenuClone = $('.active').children('.subMenu').clone();
    $subMenuClone.addClass('subMenuClone');
    return $('body').append($subMenuClone);
  };

  changeDeleteButton = function(disableInputCheck) {
    var $deleteButton;
    if (disableInputCheck == null) {
      disableInputCheck = false;
    }
    $deleteButton = $('#delete');
    $deleteButton.attr('disabled', 'disabled');
    $deleteButton.addClass('button-disabled');
    if (disableInputCheck === false) {
      return $('#list-table tr td input[type=checkbox]').each(function() {
        if ($(this).prop('checked')) {
          $deleteButton.removeClass('button-disabled');
          $deleteButton.removeAttr('disabled');
          return false;
        }
      });
    }
  };

  getAllNotifications = function($notificationsWrapper) {
    return $.ajax({
      method: 'POST',
      url: Routing.generate('OpitNotesTravelBundle_notifications_all')
    }).done(function(data) {
      $notificationsWrapper.html(data);
      $('.notification-header-delete i').on('click', function() {
        var notificationId, self;
        self = $(this);
        notificationId = $(self).data('id');
        return $.ajax({
          method: 'GET',
          url: Routing.generate('OpitNotesTravelBundle_notification_delete', {
            id: notificationId
          })
        }).done(function(data) {
          return self.closest('.notification').remove();
        });
      });
      $('.notification-details').on('click', function(event) {
        var notificationId, self;
        event.preventDefault();
        self = $(this);
        notificationId = self.data('id');
        return $.ajax({
          method: 'POST',
          url: Routing.generate('OpitNotesTravelBundle_notifications_state_change'),
          data: {
            "id": notificationId
          }
        }).complete(function() {
          return window.location.href = self.attr('href');
        });
      });
      return $notificationsWrapper.removeClass('display-none');
    });
  };

  getUnreadNotifications = function() {
    return $.ajax({
      method: 'POST',
      url: Routing.generate('OpitNotesTravelBundle_notifications_unread_count')
    }).done(function(data) {
      var $notificationsGlobe, $unreadNotificationsCount, unreadNotificationCount;
      $unreadNotificationsCount = $('#unread-notifications-count');
      $notificationsGlobe = $('#notifications i');
      unreadNotificationCount = $('#unread-notifications').html();
      if (unreadNotificationCount !== data) {
        if ('0' !== data) {
          $unreadNotificationsCount.removeClass('display-none');
          $notificationsGlobe.addClass('active-text');
          $unreadNotificationsCount.html(data);
        }
      }
      if ('0' === $unreadNotificationsCount.html()) {
        $unreadNotificationsCount.addClass('display-none');
        $notificationsGlobe.removeClass('active-text');
      }
      return setTimeout(getUnreadNotifications, 10000);
    });
  };

  $.fn.extend({
    formIsEmpty: function(element) {
      var $el, exists;
      $el = element ? $(element) : $(this);
      exists = false;
      $el.find(':input').each(function() {
        if ($(this).val()) {
          return exists = true;
        }
      });
      return exists;
    },
    checkAll: function(selector) {
      var $el, checkAll;
      $el = selector ? $(selector) : $(this);
      checkAll = $el.filter(':checked').length === $el.length ? false : true;
      $el.each(function() {
        return $(this).prop('checked', checkAll);
      });
      return changeDeleteButton();
    }
  });

  $(document).ready(function() {
    var $deleteButton, $notificationsWrapper;
    $(document).on('click', function() {
      return $('#notifications-wrapper').addClass('display-none');
    });
    $notificationsWrapper = $('#notifications-wrapper');
    $('#notifications').on('click', function(event) {
      event.stopPropagation();
      $('#notifications i').removeClass('active-text');
      $('#unread-notifications-count').addClass('display-none');
      return getAllNotifications($notificationsWrapper);
    });
    getUnreadNotifications();
    $('#loggedInUser').click(function() {
      var _ref;
      return $(document).data('OpitNotesUserBundle').funcs.userEdit($(this).children('span').data('user-id'), (_ref = $(document).data('OpitNotesUserBundle').funcs) != null ? _ref.showAlert : void 0);
    });
    $deleteButton = $('#delete');
    $deleteButton.attr('disabled', 'disabled');
    $deleteButton.addClass('button-disabled');
    $deleteButton.removeClass('delete');
    $('#list-table tr td').on('change', 'input[type=checkbox]', function() {
      return changeDeleteButton();
    });
    $(document).on('click', '.ui-button-text', function() {
      var buttonText;
      buttonText = $(this).html();
      if (buttonText === 'Yes' || buttonText === 'Continue') {
        return changeDeleteButton(true);
      }
    });
    cloneSubmenu();
    $('.menu .mainMenu').click(function() {
      $('.menu .mainMenu').removeClass('active');
      $(this).addClass("active");
      return cloneSubmenu();
    });
    return $(window).scroll(function() {
      var $menuWrapperActive;
      $menuWrapperActive = $('#menuWrapper .active');
      if ($menuWrapperActive.length > 0) {
        if ($menuWrapperActive.children('.subMenu').offset().top < $(window).scrollTop()) {
          if ($('body').has(subMenuCloneClass).length) {
            $subMenuClone.css({
              display: 'block'
            });
          }
        }
        if ($menuWrapperActive.children('.subMenu').offset().top > $(window).scrollTop()) {
          if ($('body').has(subMenuCloneClass).length) {
            return $subMenuClone.css({
              display: 'none'
            });
          }
        }
      }
    });
  });

}).call(this);
