// Generated by CoffeeScript 1.6.3
(function() {
  var $addPerDiem, disableSaveButton, validationOfGreaterThan0, validationOfHoursCompare, validationOfLessThan24,
    __indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  $addPerDiem = $('#addPerDiem');

  $addPerDiem.click(function(event) {
    event.preventDefault();
    $.ajax({
      method: 'POST',
      url: Routing.generate('OpitNotesUserBundle_admin_show_perdiem')
    }).done(function(data) {
      $('.container').append(data);
    });
  });

  $('.container').on('click', '.deletePerDiem', function() {
    var id, isDelete;
    id = $(this).parent().parent().find('#id').val();
    isDelete = $(this).parent().parent().find('#isToDelete');
    if (id > 0) {
      isDelete.val(1);
      $(this).parent().parent().hide();
    } else {
      $(this).parent().parent().remove();
    }
  });

  validationOfHoursCompare = function() {
    var hoursArray, isUnique;
    isUnique = true;
    hoursArray = [];
    $('.hours').each(function(index) {
      var _ref;
      if (_ref = $(this).val(), __indexOf.call(hoursArray, _ref) >= 0) {
        return isUnique = false;
      } else {
        return hoursArray.push($(this).val());
      }
    });
    return isUnique;
  };

  validationOfLessThan24 = function(valueOfHour) {
    var isLessThan24;
    isLessThan24 = true;
    if (24 < valueOfHour) {
      isLessThan24 = false;
    }
    return isLessThan24;
  };

  validationOfGreaterThan0 = function(valueOfAmount) {
    var isGreaterThan0;
    isGreaterThan0 = true;
    if (0 >= valueOfAmount) {
      isGreaterThan0 = false;
    }
    return isGreaterThan0;
  };

  $('.container').on('change', '.hours', function() {
    var $wrapper, errorMessage, isLessThen24, isUnique;
    isLessThen24 = validationOfLessThan24($(this).val());
    isUnique = validationOfHoursCompare();
    $wrapper = $(this).parent();
    if (!isLessThen24) {
      if ($wrapper.children('label.custom-lablel-error').length === 0) {
        errorMessage = $('<label>').html('The value of hours should be less than 24!').addClass('custom-label-error');
        $wrapper.prepend('<br />');
        $wrapper.prepend(errorMessage);
      }
      return false;
    } else if (!isUnique) {
      if ($wrapper.children('label.custom-label-error').length === 0) {
        errorMessage = $('<label>').html('The value of hours is a repeated value!').addClass('custom-label-error');
        $wrapper.prepend('<br />');
        $wrapper.prepend(errorMessage);
      }
      return false;
    } else {
      $wrapper.children('label.custom-label-error').remove();
      $wrapper.children('br').remove();
      return true;
    }
  });

  $('.container').on('change', '.amount', function() {
    var $wrapper, errorMessage, isGreaterThan0;
    isGreaterThan0 = validationOfGreaterThan0($(this).val());
    $wrapper = $(this).parent();
    console.log(isGreaterThan0);
    if (!isGreaterThan0) {
      console.log('greater');
      if ($wrapper.children('label.custom-lablel-error').length === 0) {
        console.log('wrapping');
        errorMessage = $('<label>').html('The Amount should be greater than 0!').addClass('custom-label-error');
        $wrapper.prepend('<br />');
        $wrapper.prepend(errorMessage);
        disableSaveButton(true);
      }
      return false;
    } else {
      $wrapper.children('label.custom-label-error').remove();
      $wrapper.children('br').remove();
      disableSaveButton(false);
      return true;
    }
  });

  disableSaveButton = function(disable) {
    if (disable === true) {
      return $('#save').attr('disabled', true);
    } else {
      return $('#save').removeAttr('disabled');
    }
  };

  $('#save').click(function(event) {
    var forms;
    event.preventDefault();
    forms = $('form');
    if (forms.valid() && validationOfHoursCompare()) {
      disableSaveButton(true);
      $.ajax({
        method: 'POST',
        data: forms.serialize(),
        dataType: 'json',
        url: Routing.generate('OpitNotesUserBundle_admin_save_perdiem')
      }).done(function(data) {
        var response;
        disableSaveButton(false);
        response = data;
        $.ajax({
          type: 'POST',
          url: Routing.generate('OpitNotesUserBundle_admin_list_perdiem'),
          data: {
            "showList": 1
          }
        }).done(function(data) {
          $('.container').html(data.list);
          return $(document).data('notes').funcs.showAlert(response, "create", "Per diems saved successfully!");
        }).fail(function(data) {
          return $(document).data('notes').funcs.showAlert(data.responseText, "create", "Error");
        });
      }).fail(function(data) {
        return $(document).data('notes').funcs.showAlert(data.responseText, "create", "Error");
      });
      return;
    } else {
      disableSaveButton(false);
    }
  });

}).call(this);
