// Generated by CoffeeScript 1.7.1
(function() {
  $(document).ready(function() {
    var deleteUser;
    $('#add').click(function() {
      return $.ajax({
        method: 'GET',
        url: Routing.generate('OpitNotesUserBundle_user_show', {
          id: 0
        })
      }).done(function(data) {
        $('<div id="dialog-edititem"></div>').html(data).dialog({
          title: '<i class="fa fa-list-alt"></i> Create User',
          dialogClass: 'popup-dialog',
          width: 750,
          modal: true,
          buttons: {
            Create: function() {
              return $.ajax({
                global: false,
                type: 'POST',
                url: Routing.generate('OpitNotesUserBundle_user_add', {
                  id: 0
                }),
                data: $('#adduser_frm').serialize()
              }).done(function(data) {
                var response;
                response = data;
                return $.ajax({
                  type: 'POST',
                  url: Routing.generate('OpitNotesUserBundle_user_list'),
                  data: {
                    "showList": 1
                  }
                }).done(function(data) {
                  $('#user-list').html(data);
                  $(document).data('notes').funcs.showAlert(response, 'create', 'User created successfully');
                  return $('#dialog-edititem').dialog("destroy");
                });
              }).fail(function(data) {
                var response;
                response = data.responseText;
                if (typeof response === 'string') {
                  response = $.parseJSON(response);
                }
                return $(document).data('notes').funcs.showAlert(response, 'create', 'Error');
              });
            },
            Close: function() {
              $('#dialog-edititem').dialog('destroy');
            }
          }
        });
        return;
      });
    });
    $('#userlistWrapper').on('click', '.list-username', function() {
      $(document).data('OpitNotesUserBundle').funcs.userEdit($(this).attr('data-user-id'), $(document).data('notes').funcs.showAlert);
    });
    deleteUser = function() {
      var url;
      url = Routing.generate('OpitNotesUserBundle_user_delete');
      return $(document).data('notes').funcs.deleteAction('User delete', 'user(s)', url, '.list-delete-user');
    };
    $('#userlistWrapper').on('click', '.delete-single-user', function() {
      $(this).closest('tr').find(':checkbox').not('disabled').prop('checked', true);
      return deleteUser();
    });
    $('#userlistWrapper').on('click', '.reset-password', function() {
      var userId, _self;
      _self = $(this);
      userId = _self.data('user-id');
      $(document).data('OpitNotesUserBundle').funcs.isLdapUser(userId).done(function() {
        $('<div id="reset-password-dialog"></div>').html("Are you sure you want to reset <b class='underline'>" + (_self.closest('tr').find('.list-username').html()) + "'s</b> password ? The user will be informed about new password via email.").dialog({
          title: '<i class="fa fa-exclamation-triangle"></i> Reset user password',
          dialogClass: 'popup-dialog',
          width: 750,
          modal: true,
          buttons: {
            Reset: function() {
              return $.ajax({
                global: false,
                type: 'POST',
                url: Routing.generate('OpitNotesUserBundle_user_password_reset'),
                data: {
                  'id': userId
                }
              }).done(function(data) {
                return $('#reset-password-dialog').dialog('destroy');
              }).fail(function(data) {
                return console.warn(data);
              });
            },
            Close: function() {
              $('#reset-password-dialog').dialog('destroy');
            }
          }
        });
      });
    });
    $('#userlistWrapper').on('click', 'th .fa-trash-o', function() {
      return $('.list-delete-user').filter(function() {
        return !this.disabled;
      }).checkAll();
    });
    $('#list').on('click', '#list-reply-message', function() {
      return $(this).hide();
    });
    $('#user-list').on('click', '.order-text', function() {
      return $(document).data('notes').funcs.serverSideListOrdering($(this), $(this).parent().find('i').attr('data-field'), 'OpitNotesUserBundle_user_list', 'user-list');
    });
    return $('#user-list').on('click', '.fa-sort', function() {
      return $(document).data('notes').funcs.serverSideListOrdering($(this), $(this).data('field'), 'OpitNotesUserBundle_user_list', 'user-list');
    });
  });

}).call(this);
